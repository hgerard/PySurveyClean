#PySurveyClean Development
#=======================

|     |     |
| --- | --- |
| **Module Name:** | **PySurveyClean** |
| **Author:**      | **Rory Creedon** (rcreedon@poverty-action.org) |
| **Development**  | Rory Creedon, Joshua Deutschmann, Hugo Gerard, Katherine Hoffmann, Harrison Diamond Pollock |
| **Purpose:**     | Library of Classes and Functions for optimizing the cleaning of survey data |

###Introduction<br/> 
###-------------------
This document contains development notes relating to the PySurveyClean module envisaged. Contributors to this module should use this document as a foundation for discussion as to the design of the functionality of the PySurveyClean system. In particular, it is important that the development team successfully identify common problems faced by those working with survey data, such that the solutions offered by PySurveyClean are relevant at a cross-organizational level. 

The remainder of this document is divided into the following sections:

+ Need for PySurveyClean
+ Common Cleaning Tasks
+ Extent of the PySurveyClean System
+ Building Blocks
+ Defining Basic Functionality
+ Extended Functionality
+ Workflow

---

###Need for PySurveyClean<br/>
###-----------------------------------
Many researchers are moving away from the traditional software of data cleaning and management software, Stata, to free open source solutions such as R and Python. There are many benefits to using these alternative solutions which need not be discussed here. PySurveyClean is intended to provide users who are turning to python with a library of classes and functions that will optimize survey data cleaning processes. 

PySurveyClean will attempt to optimize the survey cleaning process in the following manner:

**Workflow**<br/>
In general it seems that most researchers when cleaning data in Stata are forced to simply march through every variable in a data set and perform a number of checks on each variable. Many of the these checks are common to a great percentage of the variables in the data set, but as Stata lacks easy to implement list/dict objects performing checks common to many variables can include a lot of duplication of code. PySurveyClean can overcome this problem by offering the user object that store commonly used parameters of the cleaning process which can be accessed at any point of the process. 

Working on a variable by variable basis leads to massive inefficiencies in that erroneous observations are output for each variable, and the user must then identify the hard-copy surveys identified as containing errors *for that variable* and make replacements. As the cleaning progresses this repeated a number of times, which indicates that researchers may end up having to identify the same hard-copy survey a multitude of times. PySurveyClean can solve this problem by offering the user information about potentially erroneous data on a *per survey* basis which will clearly allow corrections be made on a *per survey basis* which should make the process much more efficient. 

**Corrections**<br/>
Once errors are identified making corrections can be a lengthy process. One of the drawbacks of using stata is that a relatively large amount of technical expertise is required to make corrections. This can lead to inefficient use of resources within a team working with survey data in that identifying the *correct value* can be done by someone with no technical expertise, but *replacing the value* requires someone with a working knowledge of Stata. PySurveyClean can overcome this inefficiency by allowing the person who identifies the correct value to note it using a familiar GUI such as Excel, and these values can then be read directly back into the data. This removes the need for technical expertise in the replacement process. 

**Documenting the Cleaning Process**<br/>
Stata do-files are typically very difficult to read, even when notes and comments are used extensively. PySurveyClean will integrate with the IPython development environment which offer users many more tools for making workflow more readable, and hence accessible. 

Additionally, PySurveyClean can offer users the options to automatically save functions used to generate output/make replacements in .json format for future reference, and it is conceivable that one of the function of PySurveyClean could be a system that reads these .json files and reports them back to the user in a format that makes it very easy to understand what operations have been undertaken on the data. 

---

###Common Cleaning Tasks<br/>
###------------------------------------
In order to make PySurvey as generalisable as possible the core functions it provides should be those which are common to most survey cleaning systems. 

Note that I (Rory) only have experience with data generated by hard-copy data collection. The common task set that relates to electronically collected data will be (potentially) totally different.

One thing that the development team might consider is putting feelers out to IPA projects to find out what tasks are common to most survey cleaning processes. However, even *ex ante* it seems fairly likely that that vast majority of operations undertaken in relation to cleaning data are the following:

+ Checking the range of continuous variables
+ Checking the values of categorical variables
+ Checking skip patterns
+ Splitting and renaming 'tick all that apply' answer fields.

---

###Extent of the PySurveyClean System
###-------------------------------------------------------
One question that needs to be decided is the extent the PySurveyClean system. It is conceivable that the system could be totally self-contained. This could potentially involve simply completing an Excel form that sets out the logic/values to be tested and then passing this form to a program that will automatically generate output. This would be a system similar to that developed by ODK. This system would then be more akin to a piece of software rather than a module that integrates into the python development environment.

Even if this method is decided to be optimal for certain common tasks (such as those listed above) this should not be the total extent of the system for the following reasons:

1. Python and the pandas library are tools that are worth understanding, and if the only option that users have for interacting with PySurveyClean is through a black box piece of software then there is no reason for them to learn python/pandas.
2. Users already familiar with python will be frustrated that they cannot use the PySurveyClean functions outside of this black box environment.
3. Many cleaning tasks are more complex than those described as common cleaning tasks, and they will not be capable of automation in the same way. If the module is not available outside of the black box system, then users will not be able to get the full benefit of PySurveyClean
4. Perhaps most importantly, PySurveyClean will never be able to undertake all cleaning related tasks. As such it is essential that it is available as a compliment to more general python/pandas techniques, rather than as a total replacement. 

PySurveyClean will not therefore offer users functions that are already available to pandas users. For example, reading data into pandas objects etc. will need to be done by the user. 

One consequence of this is that users will have to a clear idea of how the data that they have imported and plan to clean with PySurveyClean have been imported. In particular, this will mean that an understanding of the type of data being worked with will be necessary. This may cause major headaches for the development team, as pandas objects are capable of storing multiple different types of data in the same 'column'. As such making the functions of PySurveyClean generalisable to all types of possible data could be problematic. There are solutions such as automatic conversion of all data to strings, and/or checking data types before executing functions that can be explored as a more solid idea of the architecture of the module is generated. 

A slightly different approach to a self-contained system could be to produce a suite of small functions or scripts that perform a particular data cleaning task. These scripts could be used more in a case by case basis fashion by the end user, and in collaboration with other existing tools (such as stata). Most of these scripts would be written in python and/or Pandas, but would be designed to work in a flexible way from the command line (receiving std-in, manipulating the data, and sending the result to std-out). Examples might include:

+ A script to output to screen the number of unique rows for each field/column. 
+ A script to print to screen the row with missing values, and how many.
+ A script to take a random subsample of the data for testing.
+ A script that takes two arguments, replacing all instances of the first argument with the second. 

---

###Building Blocks<br/>
###-----------------------
PySurveyClean will be built on objects provided by the pandas library. Pandas is the most widely used library for data management in python, and it will also be the library that users who already clean data with python use. The object provided are extremely powerful and by building on pandas object users will be able to interact with the source code in a meaningful way. PySurveyClean will be built entirely upon python libraries. 

---

###Defining Basic Functionality<br/>
###-----------------------------------------
There are two levels of functionality envisaged:

**Interactive Functions**<br/>
PySurveyClean will offer a number of functions and objects that can be directly imported in the IPython development environment for interactive programming in the same way that other libraries make their contents available to users. 

**Cleaning System**<br/>
The same functions will be made available for a more complete data cleaning system. It is currently envisaged that this will involve passing functions to a constructor that will output an Excel file of errors that can be corrected and read back into the data in a manner that will be vaguely recognisable as that provided by the Stata system of `cfout` and `readreplace`. Much work is needed to define exactly what this system will look like both from a user GUI perspective, and a coding architecture perspective. 

In terms of this more complete cleaning system, for reasons outlined above, it seems that the use of the system of functions offered by PySurveyClean should be programmed by someone with sufficient expertise to undertake this task in an IPython environment. Once programmed these functions can then be passed to a constructor that will generate output as discussed immediately above.

For writing the Excel file, the following library is very useful: https://xlsxwriter.readthedocs.org/tutorial01.html


For the present purposes it is suggested that the tasks that both of these functions are written for the common cleaning tasks already identified. Once working for those tasks, the module can be extended to more complex tasks. 

---

###Extended Functionality<br/>
###-----------------------------------
Ideas of how to extend functionality can be included here. 

---

###Workflow
###---------------
Before development can be begun in earnest, this document needs to reach some kind of agreed upon steady state. Subsequently a more detailed readme.md file will be produced that sets out how development will be approached. Ideally PySurveyClean will be up and running in some capacity in time for the New Hampshire training in September 2014. 

Developers are asked for comments/suggestions/modifications.
